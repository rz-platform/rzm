@(editorForm: Form[EditedItem], blob:Blob, path:String, rev: String, breadcrumbs: Breadcrumbs, fileTree: FileTree)(implicit request: RepositoryRequestHeader)

@import views.html.helper._
@import base._
@import helpers._

@uploadButton(path: String) = {
<a class="upload-button" href="@routes.GitEntitiesController.uploadPage(request.repository.owner.userName, request.repository.name, rev, path)">
  <img src='@routes.Assets.at("images/upload.svg")' class="svg-icon">
</a>
}


@printNode(node: FileNode) = {
<div class="rz-menu-item @if(node.isRoot) { menu-item-divided }">
  <div class="rz-menu-link">
    <div class="rz-menu-file-tree-content rz-menu-file-tree-depth-@node.depth">
      @if(!node.isRoot) {
        @if(node.files.length > 0) {
          <img src='@routes.Assets.at("images/down.svg")' class="svg-icon file-tree-icon"/>
        } else {
          <img src='@routes.Assets.at("images/next.svg")' class="svg-icon file-tree-icon"/> }
        }

      @if(node.isRoot) {
        @request.repository.name
      } else {
        @node.data
      }

      @uploadButton(node.pathWithoutRoot)
    </div>
  </div>
</div>

@for(folder <- node.folders) {
  @printNode(folder)
}

@for(file <- node.files) {
@if(!(ExcludedFileNames contains file.data)) {
<div class="rz-menu-item">
  <a class="rz-menu-link @if(file.pathWithoutRoot == path) { rz-menu-file-tree-chosen }" href='@routes.GitEntitiesController.blob(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, file.pathWithoutRootEncoded)'>
    <div class="rz-menu-file-tree-content rz-menu-file-tree-depth-@file.depth">
      <img src='@routes.Assets.at("images/document.svg")' class="svg-icon file-tree-icon"/> @file.data
    </div>
  </a>
</div>
}
}
}

@auth(breadcrumbs.fileName) {
<div class="rz-menu rz-menu-file-tree">
  <div class="rz-menu-item">
    <a class="rz-menu-link"
       href="@routes.GitEntitiesController.collaboratorsPage(request.repository.owner.userName, request.repository.name)">
      <img src='@routes.Assets.at("images/users.svg")' class="svg-icon"/>
      @request.messages("repository.tree.collaborators")
    </a>
  </div>
  <div class="rz-menu-item">
    <a class="rz-menu-link"
       href="@routes.GitEntitiesController.downloadRepositoryArchive(request.repository.owner.userName, request.repository.name)">
      <img src='@routes.Assets.at("images/download.svg")' class="svg-icon"/>
      @request.messages("repository.tree.downloads")
    </a>
  </div>
  <div class="rz-menu-item">
    <a class="rz-menu-link"
       href="@routes.GitEntitiesController.commitLog(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, 1)">
      <img src='@routes.Assets.at("images/list.svg")' class="svg-icon"/>
      @request.messages("repository.tree.commits")
    </a>
  </div>

  @printNode(fileTree.root)
</div>
<div id="main">
  <div class="content">
    @form(routes.GitEntitiesController.edit(request.repository.owner.userName, request.repository.name), Symbol("enctype") -> "application/x-www-form-urlencoded", Symbol("accept-charset")->"UTF-8") {
    @CSRF.formField
    <div class="repo-header">
      <div class="breadcrumbs">
        <span class="breadcrumbs-repo-name">@request.repository.name</span> <span class="breadcrumbs-divider">/</span>

        @for(breadcrumb <- breadcrumbs.breadcrumbs){
        @breadcrumb.name <span class="breadcrumbs-divider">/</span>
        }

        @inputText(editorForm("fileName"), Symbol("_label") -> "", Symbol("_help") -> "")

        <a class="rz-button repo-header-download-button"
           href="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, rev, path)">
          <img src='@routes.Assets.at("images/download.svg")' class="svg-icon"/>
          @request.messages("repository.viewFile.raw")
        </a>
      </div>
      <div class="repo-header-last-modified">
        @request.messages("repository.viewFile.lastModified", blob.latestCommit.commitTime,
        blob.latestCommit.committerName)
      </div>
    </div>
    @inputText(editorForm("path"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "")
    @inputText(editorForm("rev"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "")

    <div class="actions">
      @if(blob.content.viewType == "text"){
      <input type="submit" class="rz-button" value='@request.messages("repository.edit.submit")'/>
      }
    </div>

    @if(blob.content.viewType == "text"){
    @textarea(editorForm("content"), Symbol("class") -> "editor", Symbol("id") -> "code", Symbol("_label") -> "",
    Symbol("_help") -> "")
    }

    @if(blob.content.viewType == "image"){
    <img
      src="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, path)"/>
    }

    @if(blob.content.viewType == "large" || blob.content.viewType == "binary"){
    <a
      href="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, path)">
      @request.messages("repository.viewFile.cant")
    </a>
    }
    }
  </div>
</div>

<script src='@routes.Assets.at("dist/javascript/view.js")' type="text/javascript"></script>
}
