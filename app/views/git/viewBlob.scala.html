@(editorForm: Form[EditedItem], blob:Blob, path:String, rev: String, breadcrumbs: Breadcrumbs, fileTree: FileTree, newItemForm: Form[NewItem])(implicit request: RepositoryRequestHeader)

@import views.html.helper._
@import base._
@import helpers._

@printNode(node: FileNode) = {
<div class="rz-menu-item @if(node.isRoot) { menu-item-divided }"  depth="@node.depth" path="@node.pathWithoutRootUrlEncoded">
  <div class="rz-menu-link">
    <div class="rz-menu-file-tree-content rz-menu-file-tree-depth-@node.depth">
      <div class="rz-menu-file-tree-depth-@node.depth-content">
      @if(!node.isRoot) {
        @if(node.files.length > 0) {
          <img src='@routes.Assets.at("images/down.svg")' class="svg-icon file-tree-icon"/>
        } else {
          <img src='@routes.Assets.at("images/next.svg")' class="svg-icon file-tree-icon"/> }
        }

      @if(node.isRoot) {
        @request.repository.name
      } else {
        @node.data
      }
      </div>
      <div class="action-buttons">
        <a href="@routes.GitEntitiesController.uploadPage(request.repository.owner.userName, request.repository.name, rev, path)">
          <img src='@routes.Assets.at("images/upload.svg")' class="svg-icon">
        </a>
        <img src='@routes.Assets.at("images/add-file.svg")' class="svg-icon add-file-button file-tree-icon" />
        <img src='@routes.Assets.at("images/add-folder.svg")' class="svg-icon add-folder-button file-tree-icon" />
      </div>
    </div>
  </div>
</div>

@for(folder <- node.folders) {
  @printNode(folder)
}

@for(file <- node.files) {
@if(!(ExcludedFileNames contains file.data)) {
<div class="rz-menu-item" depth="@file.depth">
  <a class="rz-menu-link @if(file.pathWithoutRoot == path) { rz-menu-file-tree-chosen }" href='@routes.GitEntitiesController.blob(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, file.pathWithoutRootEncoded)'>
    <div class="rz-menu-file-tree-content rz-menu-file-tree-depth-@file.depth">
      <img src='@routes.Assets.at("images/document.svg")' class="svg-icon file-tree-icon"/> @file.data
    </div>
  </a>
</div>
}
}
}

@auth(breadcrumbs.fileName, true) {
@form(routes.GitEntitiesController.addNewItem(request.repository.owner.userName, request.repository.name), Symbol("id") -> "new-item-form") {
@CSRF.formField
@inputText(newItemForm("path"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden", Symbol("id") -> "new-item-form-path")
@inputText(newItemForm("rev"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden")
@checkbox(newItemForm("isFolder"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden", Symbol("id") -> "new-item-form-is-folder")
@inputText(newItemForm("name"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden", Symbol("id") -> "new-item-form-name")
}

<div class="rz-sidebar">
    <div class="rz-sidebar-filetree">
      <div class="rz-menu-file-tree">
        @printNode(fileTree.root)
      </div>
    </div>

    <div class="rz-editor-content">
      @repositoryHeader()
    @form(routes.GitEntitiesController.edit(request.repository.owner.userName, request.repository.name), Symbol("enctype") -> "application/x-www-form-urlencoded", Symbol("accept-charset")->"UTF-8", Symbol("class")->"rz-editor-form") {
    @CSRF.formField
    <div class="rz-editor-content-header">
      <div class="breadcrumbs">
        <span class="breadcrumbs-repo-name">@request.repository.name</span> <span class="breadcrumbs-divider">/</span>

        @for(breadcrumb <- breadcrumbs.breadcrumbs){
        @breadcrumb.name <span class="breadcrumbs-divider">/</span>
        }

        @inputText(editorForm("fileName"), Symbol("_label") -> "", Symbol("_help") -> "")
      </div>
      <div class="actions">
        @if(blob.content.viewType == "text"){
        <input type="submit" class="rz-button button-small" value='@request.messages("repository.edit.submit")'/>
        }
        <a class="rz-button button-small"
           href="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, rev, path)">
          <img src='@routes.Assets.at("images/download.svg")' class="svg-icon"/>
          @request.messages("repository.viewFile.raw")
        </a>
      </div>
      <div class="repo-header-last-modified">
        @request.messages("repository.viewFile.lastModified", blob.latestCommit.commitTime,
        blob.latestCommit.committerName)
      </div>
    </div>
    @notificationHeader()
    @inputText(editorForm("path"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden")
    @inputText(editorForm("rev"), Symbol("hidden")->"hidden", Symbol("_label") -> "", Symbol("_help") -> "", Symbol("_class")->"hidden")
    @if(blob.content.viewType == "text"){
      <div class="code-wrap"><textarea class="editor" id="code" name="content">@blob.content.content.getOrElse("")</textarea></div>
    }
    @if(blob.content.viewType == "image"){
    <img
      src="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, path)"/>
    }

    @if(blob.content.viewType == "large" || blob.content.viewType == "binary"){
    <a
      href="@routes.GitEntitiesController.raw(request.repository.owner.userName, request.repository.name, request.repository.defaultBranch, path)">
      @request.messages("repository.viewFile.cant")
    </a>
    }
    }
  </div>
</div>
<script src='@routes.Assets.at("dist/javascript/view.js")' type="text/javascript"></script>
}
